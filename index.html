<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link href="./assets/css/style.css" rel="stylesheet" type="text/css">
    <!-- Fonts and Icons -->
    <link href="assets/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Hidden Chat | Talk freely!</title>
</head>

<body class="container-fluid m-0 p-0 g-0 chat-body">
    <!-- Modal -->
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Voice message</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body d-flex justify-content-center">
                    <button type="button" class="btn btn-lg btn-primary">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal End -->
    <main class="row m-0 p-0 g-0">
        <div class="col-12 top-caption">
            <h1 class="p-0 m-0">HiddenChat<span class="ps-3"><i class="fas fa-ghost"></i></span></h1>
            <nav class="col-12">
                <ul class="list-unstyled m-0 p-0">
                    <li class="list-inline-item">
                        <a href="#">Link 1</a>
                    </li>
                    <li class="list-inline-item">
                        <a href="#">Link 2</a>
                    </li>
                    <li class="list-inline-item">
                        <a href="#">Link 3</a>
                    </li>
                    <li class="list-inline-item">
                        <a href="#">Link 4</a>
                    </li>
                    <li class="list-inline-item">
                        <a href="#">Link 5</a>
                    </li>
                </ul>
            </nav>
        </div>
        <div class="col-12">
            <div class="row g-0 m-0 p-0">
                <!-- Chat Contacts -->
                <div class="col contacts" style="padding-top: 65px;">
                    <form action="#" method="GET" onsubmit="return false;">
                        <input type="text" name="search" class="form-control mb-3" placeholder="Search contact here...">
                        <button type="submit" name="search_contact"
                            class="d-flex justify-content-between btn btn-primary col-12">
                            <span class="m-0 p-0">Search</span>
                        </button>
                    </form>
                    <ul class="list-unstyled">
                        <li class="list-item mb-3 px-3 d-flex align-items-center justify-content-between">
                            <img src="./assets/img/car3.jpg" class="avatar shadow">
                            <span class="ps-4">Nickname</span>
                        </li>
                    </ul>
                </div>
                <!-- Actual Chat -->
                <div class="col-9 d-flex flex-column chat-section">
                    <div class="chat-line flex-grow-1 p-4">
                        <!-- Chat Bubble -->
                        <div class="d-flex">
                            <img src="./assets/img/car3.jpg" class="profile-favicon shadow me-3" alt="Profile image">
                            <p class="message-bubble left">Lorem ipsum dolor sit amet, consectetur adipisicing elit.
                                Voluptatem consequuntur totam quam
                                deserunt
                                rem debitis similique recusandae dolorem consectetur corporis blanditiis dolor libero
                                deleniti
                                minima ipsa, veritatis fugiat voluptas corrupti!
                                <span class="d-block pt-2 timestamp fw-bold">8:23 11.5.21г.</span>
                            </p>
                        </div>
                        <!-- End -->
                        <!-- Chat Bubble -->
                        <div class="d-flex">
                            <img src="./assets/img/car3.jpg" class="profile-favicon shadow me-3" alt="Profile image">
                            <p class="message-bubble left">Lorem ipsum dolor sit amet, consectetur adipisicing elit.
                                Voluptatem consequuntur totam quam
                                deserunt
                                rem debitis similique recusandae dolorem consectetur corporis blanditiis dolor libero
                                deleniti
                                minima ipsa, veritatis fugiat voluptas corrupti!
                                <span class="d-block pt-2 timestamp fw-bold">8:23 11.5.21г.</span>
                            </p>
                        </div>
                        <!-- End -->
                        <!-- Chat Bubble -->
                        <div class="d-flex">
                            <img src="./assets/img/car3.jpg" class="profile-favicon shadow me-3" alt="Profile image">
                            <p class="message-bubble left">Lorem ipsum dolor sit amet, consectetur adipisicing elit.
                                Voluptatem consequuntur totam quam
                                deserunt
                                rem debitis similique recusandae dolorem consectetur corporis blanditiis dolor libero
                                deleniti
                                minima ipsa, veritatis fugiat voluptas corrupti!
                                <span class="d-block pt-2 timestamp fw-bold">8:23 11.5.21г.</span>
                            </p>
                        </div>
                        <!-- End -->
                    </div>
                    <div class="chat-box p-3">
                        <form id="chat-form" class="d-flex flex-column justify-content-center" action="#" method="POST"
                            onsubmit="return false;">
                            <textarea class="form-control" placeholder="Type your message here..."
                                style="min-height: 150px; resize: none;" name=message""></textarea>
                            <div class="d-flex align-items-center mt-4">
                                <button type="submit" name="send" class="btn btn-lg btn-primary col-4">Send<i
                                        class="ps-3 fas fa-paper-plane"></i></button>
                                <ul class="m-0 d-flex align-self-center list-unstyled list-inline chat-actions">
                                    <li class="list-inline-item align-self-center ps-2">
                                        <input type="file" name="file-attachment" class="form-control">
                                    </li>
                                    <li class="list-inline-item ps-2">
                                        <button type="button" class="btn btn-lg btn-primary" data-bs-toggle="modal"
                                            data-bs-target="#exampleModal">
                                            <i class="fas fa-microphone"></i>
                                        </button>
                                    </li>
                                </ul>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="video-wrapper rounded" id="video-wrapper">
                <video id="webcam" width="608" height="342" muted></video>
                <div class="d-flex buttons">
                    <button type="button" class="btn btn-lg btn-primary mx-2"
                        style="width: 50px;height: 50px;border-radius: 50%;">
                        <i class="fas fa-volume-mute"></i>
                    </button>
                    <button type="button" class="btn btn-lg btn-danger mx-2" id="hideWebcam">
                        Hide me
                    </button>
                </div>
            </div>
        </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
        crossorigin="anonymous"></script>
    <script src="./src/client.js" type="module"></script>
    <script>
        $(document).ready(function () {
            const hideTiming = 1500;

            const hdFormat = { width: 1280, height: 720 };

            async function getMedia() {
                try {
                    return await navigator.mediaDevices.getUserMedia({ audio: true, video: hdFormat });
                } catch (err) {
                    console.log(err);
                    //Block the app in case the user hasn't enabled video and audio
                    blockApp();
                }
            }

            $(document).ready(async function () {
                let canvas = document.getElementById('webcam');

                let streamHandler = null;

                try {
                    streamHandler = await getMedia();
                } catch (err) {
                    console.log(err);
                }

                window.stream = streamHandler;

                window.stream.getTracks().forEach(function (track) {
                    console.log(track);
                });

                canvas.srcObject = streamHandler;

                console.log(canvas.srcObject);

                canvas.oncanplay = function (ev) {
                    //show in the video element what is being captured by the webcam
                    canvas.play();
                };

                $('#hideWebcam').click(function () {
                    $('#video-wrapper').fadeToggle(hideTiming);
                });
            });

            function blockApp() {
                $('.chat-body').attr('class', 'container-fluid m-0 p-0 g-0 chat-body blocked');
            }

            dragElement(document.getElementById("video-wrapper"));

            function dragElement(elmnt) {
                var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
                if (document.getElementById(elmnt.id + "header")) {
                    /* if present, the header is where you move the DIV from:*/
                    document.getElementById(elmnt.id + "header").onmousedown = dragMouseDown;
                } else {
                    /* otherwise, move the DIV from anywhere inside the DIV:*/
                    elmnt.onmousedown = dragMouseDown;
                }

                function dragMouseDown(e) {
                    e = e || window.event;
                    e.preventDefault();
                    // get the mouse cursor position at startup:
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    document.onmouseup = closeDragElement;
                    // call a function whenever the cursor moves:
                    document.onmousemove = elementDrag;
                }

                function elementDrag(e) {
                    e = e || window.event;
                    e.preventDefault();
                    // calculate the new cursor position:
                    pos1 = pos3 - e.clientX;
                    pos2 = pos4 - e.clientY;
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    // set the element's new position:
                    elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
                    elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
                }

                function closeDragElement() {
                    /* stop moving when mouse button is released:*/
                    document.onmouseup = null;
                    document.onmousemove = null;
                }
            }
        });
    </script>
</body>

</html>